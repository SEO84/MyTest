package Shw1013_MBTI;

import java.awt.BorderLayout;
import java.awt.Font;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Image;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import javax.swing.BorderFactory;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.JWindow;
import javax.swing.Timer;

public class MBTITestGUI {
	// MBTI ì ìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´ë“¤
	private int[] ieScores = new int[2]; // [0]: I, [1]: E
	private int[] snScores = new int[2]; // [0]: S, [1]: N
	private int[] tfScores = new int[2]; // [0]: T, [1]: F
	private int[] jpScores = new int[2]; // [0]: J, [1]: P

	// ë™ë¬¼ ë° ì‹ë¬¼ì— ëŒ€í•œ MBTI ë§¤í•‘
	private static final char[][] MBTI_MAPPING = { { 'I', 'S', 'T', 'J' }, // ë…ìˆ˜ë¦¬, ì†Œë‚˜ë¬´
			{ 'E', 'N', 'F', 'P' }, // ëŒê³ ë˜, ë¯¼ë“¤ë ˆ
			{ 'I', 'S', 'F', 'P' }, // íŒ¬ë”, ë°ì´ì§€
			{ 'E', 'N', 'T', 'J' }, // ëŠ‘ëŒ€, ë‹¬ë¦¬ì•„
			{ 'I', 'N', 'F', 'J' }, // ê³ ë˜, ë¼ë²¤ë”
			{ 'E', 'S', 'T', 'P' }, // ë§, í•´ë°”ë¼ê¸°
			{ 'I', 'N', 'T', 'P' }, // ë¬¸ì–´, ì•„ì´ë¹„
			{ 'E', 'S', 'F', 'J' }, // ê°œ, ë°±í•©
			{ 'I', 'S', 'T', 'P' }, // ê³ ì–‘ì´, ì„ ì¸ì¥
			{ 'E', 'N', 'F', 'J' }, // ë°±ì¡°, ëª¨ë€
			{ 'E', 'S', 'T', 'J' }, // ì‚¬ì, ì¥ë¯¸
			{ 'I', 'N', 'F', 'P' }, // í† ë¼, ììŠ¤ë¯¼
			{ 'I', 'S', 'F', 'J' }, // ì½”ë¼ë¦¬, ì¹´ë°€ë ˆ
			{ 'E', 'N', 'T', 'P' }, // ì—¬ìš°, íˆì•„ì‹ ìŠ¤
			{ 'E', 'S', 'F', 'P' }, // ì•µë¬´ìƒˆ, íŠ¤ë¦½
			{ 'I', 'N', 'T', 'J' } // ì˜¬ë¹¼ë¯¸, ì•„ë§ˆë¦´ë¦¬ìŠ¤
	};

	private String userName; // ì‚¬ìš©ìì˜ ì´ë¦„
	private String userPhone; // ì‚¬ìš©ìì˜ ì „í™”ë²ˆí˜¸
	private String userMBTI; // ì‚¬ìš©ìì˜ MBTI ìœ í˜•
	private int currentStep = 0; // í˜„ì¬ ë‹¨ê³„
	private boolean isAnimalStep = true; // í˜„ì¬ ë‹¨ê³„ê°€ ë™ë¬¼ ì„ íƒì¸ì§€ ì—¬ë¶€
	private int animalSelectionCount = 0; // ë™ë¬¼ ì„ íƒ íšŸìˆ˜
	private int plantSelectionCount = 0; // ì‹ë¬¼ ì„ íƒ íšŸìˆ˜
	private JFrame mainFrame; // ë©”ì¸ í”„ë ˆì„

	// ë™ë¬¼ ë° ì‹ë¬¼ ì´ë¦„ ë°°ì—´
	private static final String[] ANIMALS = { "ë…ìˆ˜ë¦¬", "ëŒê³ ë˜", "íŒ¬ë”", "ëŠ‘ëŒ€", "ê³ ë˜", "ë§", "ë¬¸ì–´", "ê°œ", "ê³ ì–‘ì´", "ë°±ì¡°", "ì‚¬ì", "í† ë¼",
			"ì½”ë¼ë¦¬", "ì—¬ìš°", "ì•µë¬´ìƒˆ", "ì˜¬ë¹¼ë¯¸" };
	private static final String[] PLANTS = { "ì†Œë‚˜ë¬´", "ë¯¼ë“¤ë ˆ", "ë°ì´ì§€", "ë‹¬ë¦¬ì•„", "ë¼ë²¤ë”", "í•´ë°”ë¼ê¸°", "ì•„ì´ë¹„", "ë°±í•©", "ì„ ì¸ì¥", "ëª¨ë€", "ì¥ë¯¸",
			"ììŠ¤ë¯¼", "ì¹´ë°€ë ˆ", "íˆì•„ì‹ ìŠ¤", "íŠ¤ë¦½", "ì•„ë§ˆë¦´ë¦¬ìŠ¤" };

	private MBTITestDAO dao = new MBTITestDAO(); // ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ê°ì²´

	// ìƒì„±ì: ì‚¬ìš©ì ì´ë¦„ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ë°›ì•„ GUI ì´ˆê¸°í™”
	public MBTITestGUI(String name, String phone) {
		this.userName = name;
		this.userPhone = phone;
		mainFrame = new JFrame("MBTI Test"); // ë©”ì¸ í”„ë ˆì„ ìƒì„±
		mainFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE); // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ
		mainFrame.setSize(800, 600); // í”„ë ˆì„ í¬ê¸° ì„¤ì •

		// í™”ë©´ ì¤‘ì•™ì— í”„ë ˆì„ ìœ„ì¹˜ì‹œí‚¤ê¸°
		mainFrame.setLocationRelativeTo(null);

		updateUI(mainFrame); // UI ì—…ë°ì´íŠ¸
		mainFrame.setVisible(true); // í”„ë ˆì„ì„ ë³´ì´ë„ë¡ ì„¤ì •
	}

	private void updateUI(JFrame frame) {
		// ê¸°ì¡´ì˜ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ì œê±°í•˜ì—¬ UIë¥¼ ì´ˆê¸°í™”
		frame.getContentPane().removeAll();

		// ë©”ì¸ íŒ¨ë„ ìƒì„± ë° ì„¤ì • (BorderLayout ì‚¬ìš©)
		JPanel mainPanel = new JPanel(new BorderLayout(10, 10));
		mainPanel.setBorder(BorderFactory.createEmptyBorder(20, 20, 20, 20)); // íŒ¨ë„ì— ì—¬ë°± ì¶”ê°€

		// ì˜µì…˜ì„ í‘œì‹œí•  íŒ¨ë„ ìƒì„± (2x2 GridLayout ì‚¬ìš©)
		JPanel panel = new JPanel(new GridLayout(2, 2, 20, 20));
		mainPanel.add(panel, BorderLayout.CENTER); // ë©”ì¸ íŒ¨ë„ì˜ ì¤‘ì•™ì— ì˜µì…˜ íŒ¨ë„ ì¶”ê°€
		frame.add(mainPanel); // í”„ë ˆì„ì— ë©”ì¸ íŒ¨ë„ ì¶”ê°€

		// í˜„ì¬ ë‹¨ê³„ì— ë”°ë¼ ë™ë¬¼ ë˜ëŠ” ì‹ë¬¼ ì˜µì…˜ì„ ì„ íƒ
		String[] currentOptions = isAnimalStep ? ANIMALS : PLANTS;
		int offset = (currentStep % 4) * 4; // í˜„ì¬ ë‹¨ê³„ì— ë”°ë¥¸ ì˜µì…˜ì˜ ì‹œì‘ ì¸ë±ìŠ¤ ê³„ì‚°

		// 4ê°œì˜ ì˜µì…˜ì„ íŒ¨ë„ì— ì¶”ê°€
		for (int i = 0; i < 4; i++) {
			if (offset + i < currentOptions.length) {
				String option = currentOptions[offset + i];
				ImageIcon originalIcon = loadImageIcon(option); // ì˜µì…˜ì— í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ ë¡œë“œ

				if (originalIcon != null) {
					// ê° ì˜µì…˜ì„ ìœ„í•œ íŒ¨ë„ ìƒì„±
					JPanel optionPanel = new JPanel();
					optionPanel.setLayout(new BorderLayout(5, 5));

					// ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ
					Image scaledImage = originalIcon.getImage().getScaledInstance(200, 200, Image.SCALE_SMOOTH);
					ImageIcon scaledIcon = new ImageIcon(scaledImage);

					// ë²„íŠ¼ ìƒì„± ë° ì„¤ì •
					JButton button = new JButton(scaledIcon);
					button.setBorderPainted(false); // ë²„íŠ¼ í…Œë‘ë¦¬ ì œê±°
					button.setContentAreaFilled(false); // ë²„íŠ¼ ë°°ê²½ ì œê±°
					button.addActionListener(new ImageSelectionListener(option)); // ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€

					// ë¼ë²¨ ìƒì„± ë° ì„¤ì •
					JLabel nameLabel = new JLabel(option, JLabel.CENTER);
					nameLabel.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.BOLD, 14)); // í°íŠ¸ ì„¤ì •

					// íŒ¨ë„ì— ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
					optionPanel.add(button, BorderLayout.CENTER);
					optionPanel.add(nameLabel, BorderLayout.SOUTH);

					panel.add(optionPanel); // ì˜µì…˜ íŒ¨ë„ì„ ë©”ì¸ íŒ¨ë„ì— ì¶”ê°€
				}
			}
		}

		// UIë¥¼ ê°±ì‹ í•˜ì—¬ ë³€ê²½ ì‚¬í•­ ë°˜ì˜
		frame.revalidate();
		frame.repaint();
	}

	private ImageIcon loadImageIcon(String option) {
		// ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ìƒì„±
		String imagePath = "/images/" + option + ".jpg";
		// ì´ë¯¸ì§€ URLì„ ê°€ì ¸ì˜´
		java.net.URL imageUrl = getClass().getResource(imagePath);
		// ì´ë¯¸ì§€ê°€ ì¡´ì¬í•˜ë©´ ImageIcon ìƒì„±, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ null ë°˜í™˜
		return imageUrl != null ? new ImageIcon(imageUrl) : null;
	}

	// ì´ë¯¸ì§€ ì„ íƒ ì‹œ ë™ì‘ì„ ì •ì˜í•˜ëŠ” ë¦¬ìŠ¤ë„ˆ í´ë˜ìŠ¤
	private class ImageSelectionListener implements ActionListener {
		private final String option; // ì„ íƒëœ ì˜µì…˜ ì´ë¦„

		public ImageSelectionListener(String option) {
			this.option = option; // ì˜µì…˜ ì´ë¦„ ì´ˆê¸°í™”
		}

		@Override
		public void actionPerformed(ActionEvent e) {
			// ì„ íƒëœ ì˜µì…˜ì— ë”°ë¼ ì ìˆ˜ ì—…ë°ì´íŠ¸
			updateScoreFromSelection(option);
			if (isAnimalStep) {
				animalSelectionCount++; // ë™ë¬¼ ì„ íƒ íšŸìˆ˜ ì¦ê°€
			} else {
				plantSelectionCount++; // ì‹ë¬¼ ì„ íƒ íšŸìˆ˜ ì¦ê°€
			}
			currentStep++; // í˜„ì¬ ë‹¨ê³„ ì¦ê°€
			if (currentStep % 4 == 0) {
				isAnimalStep = !isAnimalStep; // 4ë‹¨ê³„ë§ˆë‹¤ ë™ë¬¼/ì‹ë¬¼ ë‹¨ê³„ ì „í™˜
			}
			if (animalSelectionCount + plantSelectionCount == 8) {
				showResult(); // ëª¨ë“  ì„ íƒì´ ì™„ë£Œë˜ë©´ ê²°ê³¼ í‘œì‹œ
			} else {
				updateUI(mainFrame); // UI ì—…ë°ì´íŠ¸
			}
		}
	}

	private void updateScoreFromSelection(String option) {
		// í˜„ì¬ ë‹¨ê³„ì— ë”°ë¼ ì„ íƒëœ ì˜µì…˜ì˜ ì¸ë±ìŠ¤ë¥¼ ì°¾ìŒ
		int index = Arrays.asList(isAnimalStep ? ANIMALS : PLANTS).indexOf(option);
		if (index != -1) {
			// í•´ë‹¹ ì¸ë±ìŠ¤ì˜ MBTI ë¬¸ìë¥¼ ê°€ì ¸ì™€ ì ìˆ˜ ì—…ë°ì´íŠ¸
			char[] mbtiChars = MBTI_MAPPING[index];
			updateScores(mbtiChars);
		}
	}

	private void updateScores(char[] mbtiChars) {
		// ê° MBTI ì§€í‘œì— ë”°ë¼ ì ìˆ˜ ì¦ê°€
		if (mbtiChars[0] == 'I')
			ieScores[0]++;
		else
			ieScores[1]++;
		if (mbtiChars[1] == 'S')
			snScores[0]++;
		else
			snScores[1]++;
		if (mbtiChars[2] == 'T')
			tfScores[0]++;
		else
			tfScores[1]++;
		if (mbtiChars[3] == 'J')
			jpScores[0]++;
		else
			jpScores[1]++;
	}

	private void showResult() {
		StringBuilder result = new StringBuilder();

		// MBTI ê²°ê³¼ ê³„ì‚°
		result.append(ieScores[0] == ieScores[1] ? (Math.random() < 0.5 ? "I" : "E")
				: (ieScores[0] > ieScores[1] ? "I" : "E"));

		result.append(snScores[0] == snScores[1] ? (Math.random() < 0.5 ? "S" : "N")
				: (snScores[0] > snScores[1] ? "S" : "N"));

		result.append(tfScores[0] == tfScores[1] ? (Math.random() < 0.5 ? "T" : "F")
				: (tfScores[0] > tfScores[1] ? "T" : "F"));

		result.append(jpScores[0] == jpScores[1] ? (Math.random() < 0.5 ? "J" : "P")
				: (jpScores[0] > jpScores[1] ? "J" : "P"));

		userMBTI = result.toString(); // ìµœì¢… MBTI ê²°ê³¼ ì €ì¥

		// DBì— ê²°ê³¼ ì €ì¥
		MBTITestDTO resultDTO = new MBTITestDTO(userName, userPhone, userMBTI);
		int success = dao.addResult(resultDTO);

		// MBTI ê²°ê³¼ì™€ ê¶í•© ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” ë‹¤ì´ì–¼ë¡œê·¸ ìƒì„±
		showMBTICompatibilityDialog(userMBTI);

		// ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
		resetTest();
		showUserInputDialog();
		mainFrame.dispose(); // í˜„ì¬ í”„ë ˆì„ ë‹«ê¸°
	}

	private static int calculateCompatibilityScore(String mbti1, String mbti2) {
		// ë‘ MBTI ìœ í˜•ì´ ë™ì¼í•œ ê²½ìš°
		if (mbti1.equals(mbti2)) {
			return 50; // ê°™ì€ ìœ í˜•ë¼ë¦¬ì˜ ë³´í†µ ê¶í•©
		}

		// ë‘ MBTI ìœ í˜•ì´ ì˜ ë§ëŠ” ê²½ìš°
		if (isGoodMatch(mbti1, mbti2)) {
			return 80; // ì˜ ë§ëŠ” ê¶í•©ì˜ ê²½ìš°
		}

		// ë‘ MBTI ìœ í˜•ì´ ë„ì „ì ì¸ ê´€ê³„ì¸ ê²½ìš°
		if (isChallengingMatch(mbti1, mbti2)) {
			return 20; // ë„ì „ì ì¸ ê¶í•©ì˜ ê²½ìš°
		}

		return 0; // ì¤‘ë¦½ ê¶í•©
	}

	// ë‘ MBTI ìœ í˜•ì´ ì˜ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë©”ì†Œë“œ
	private static boolean isGoodMatch(String mbti1, String mbti2) {
		Map<String, List<String>> goodMatches = getMatches(true); // ì˜ ë§ëŠ” ê¶í•© ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
		return goodMatches.containsKey(mbti1) && goodMatches.get(mbti1).contains(mbti2);
	}

	// ë‘ MBTI ìœ í˜•ì´ ë„ì „ì ì¸ ê´€ê³„ì¸ì§€ í™•ì¸í•˜ëŠ” ë©”ì†Œë“œ
	private static boolean isChallengingMatch(String mbti1, String mbti2) {
		Map<String, List<String>> challengingMatches = getMatches(false); // ë„ì „ì ì¸ ê¶í•© ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
		return challengingMatches.containsKey(mbti1) && challengingMatches.get(mbti1).contains(mbti2);
	}

	// ì˜ ë§ëŠ” ê¶í•© ë˜ëŠ” ë„ì „ì ì¸ ê¶í•© ëª©ë¡ì„ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œ
	private static Map<String, List<String>> getMatches(boolean isGoodMatch) {
		Map<String, List<String>> matches = new HashMap<>();

		if (isGoodMatch) {
			// ì˜ ë§ëŠ” ê¶í•© ëª©ë¡
			matches.put("ESTJ", Arrays.asList("ENFP", "ESFP", "ESTJ", "ESTP", "ISFP"));
			matches.put("ENTJ", Arrays.asList("ENFP", "ENTJ", "ENTP", "ESFP", "INFP"));
			matches.put("ESFJ", Arrays.asList("ENTP", "ESFJ", "ESFP", "ESTP", "ISTP"));
			matches.put("ENFJ", Arrays.asList("ENFJ", "ENFP", "ENTP", "ESTP", "INTP"));
			matches.put("ISTJ", Arrays.asList("ESFP", "INFP", "ISFP", "ISTJ", "ISTP"));
			matches.put("ISFJ", Arrays.asList("ESTP", "INTP", "ISFJ", "ISFP", "ISTP"));
			matches.put("INFJ", Arrays.asList("ENTP", "INFJ", "INFP", "INTP", "ISTP"));
			matches.put("INTJ", Arrays.asList("ENFP", "INFP", "INTJ", "INTP", "ISFP"));
			matches.put("ESTP", Arrays.asList("ENFJ", "ESFJ", "ESTJ", "ESTP", "ISFJ"));
			matches.put("ESFP", Arrays.asList("ENTJ", "ESFJ", "ESFP", "ESTJ", "ISTJ"));
			matches.put("ISTP", Arrays.asList("ESFJ", "INFJ", "ISFJ", "ISTJ", "ISTP"));
			matches.put("ISFP", Arrays.asList("ESTJ", "INTJ", "ISFJ", "ISFP", "ISTJ"));
			matches.put("INFP", Arrays.asList("ENTJ", "INFJ", "INFP", "INTJ", "ISTJ"));
			matches.put("INTP", Arrays.asList("ENFJ", "INFJ", "INTJ", "INTP", "ISFJ"));
			matches.put("ENFP", Arrays.asList("ENFJ", "ENFP", "ENTJ", "ESTJ", "INTJ"));
			matches.put("ENTP", Arrays.asList("ENFJ", "ENTJ", "ENTP", "ESFJ", "INFJ"));
		} else {
			// ë„ì „ì ì¸ ê¶í•© ëª©ë¡
			matches.put("ESTJ", Arrays.asList("ENFJ", "INFJ"));
			matches.put("ENTJ", Arrays.asList("ESFJ", "ISFJ"));
			matches.put("ESFJ", Arrays.asList("ENTJ", "INTJ"));
			matches.put("ENFJ", Arrays.asList("ESTJ", "ISTJ"));
			matches.put("ISTJ", Arrays.asList("ENFJ", "INFJ"));
			matches.put("ISFJ", Arrays.asList("ENTJ", "INTJ"));
			matches.put("INFJ", Arrays.asList("ESTJ", "ISTJ"));
			matches.put("INTJ", Arrays.asList("ESFJ", "ISFJ"));
			matches.put("ESTP", Arrays.asList("ENFP", "INFP"));
			matches.put("ESFP", Arrays.asList("ENTP", "INTP"));
			matches.put("ISTP", Arrays.asList("ENFP", "INFP"));
			matches.put("ISFP", Arrays.asList("ENTP", "INTP"));
			matches.put("INFP", Arrays.asList("ESTP", "ISTP"));
			matches.put("INTP", Arrays.asList("ESFP", "ISFP"));
			matches.put("ENFP", Arrays.asList("ESTP", "ISTP"));
			matches.put("ENTP", Arrays.asList("ENFP", "INFP"));
		}

		return matches;
	}

	private void showMBTICompatibilityDialog(String mbti) {
		// DBì—ì„œ ëª¨ë“  ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
		List<MBTITestDTO> allResults = dao.getAllResults();

		// ê¶í•©ì´ ì˜ ë§ëŠ” ì‚¬ëŒë“¤ê³¼ ë„ì „ì ì¸ ê´€ê³„ì˜ ì‚¬ëŒë“¤ì„ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸
		List<String> goodMatches = new ArrayList<>();
		List<String> challengingMatches = new ArrayList<>();

		// ê° ì €ì¥ëœ ê²°ê³¼ì— ëŒ€í•´ ê¶í•© í™•ì¸
		for (MBTITestDTO person : allResults) {
			if (!person.getName().equals(userName)) { // ìê¸° ìì‹  ì œì™¸
				String compatibility = checkCompatibility(mbti, person.getMbti());
				if (compatibility.equals("GOOD")) {
					goodMatches.add(String.format("%s (%s)", person.getName(), person.getMbti()));
				} else if (compatibility.equals("BAD")) {
					challengingMatches.add(String.format("%s (%s)", person.getName(), person.getMbti()));
				}
			}
		}

		// ê²°ê³¼ ë©”ì‹œì§€ ìƒì„±
		StringBuilder message = new StringBuilder();
		message.append("ë‹¹ì‹ ì˜ MBTIëŠ”: ").append(mbti).append("\n\n");

		message.append("â–¶ ìµœê³ ì˜ ê¶í•©ì¸ ì‚¬ëŒë“¤:\n");
		if (goodMatches.isEmpty()) {
			message.append("ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n");
		} else {
			for (String match : goodMatches) {
				message.append("- ").append(match).append("\n");
			}
		}

		message.append("\nâ–¶ ìµœì•…ì˜ ê¶í•©ì¸ ì‚¬ëŒë“¤:\n");
		if (challengingMatches.isEmpty()) {
			message.append("ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n");
		} else {
			for (String match : challengingMatches) {
				message.append("- ").append(match).append("\n");
			}
		}

		// ë©”ì‹œì§€ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
		JOptionPane.showMessageDialog(null, message.toString(), "MBTI ê¶í•© ê²°ê³¼", JOptionPane.INFORMATION_MESSAGE);
	}

	private String checkCompatibility(String mbti1, String mbti2) {
		// ë‘ MBTI ìœ í˜•ì´ ì˜ ë§ëŠ”ì§€ í™•ì¸
		if (isGoodMatch(mbti1, mbti2)) {
			return "GOOD";
		} else if (isChallengingMatch(mbti1, mbti2)) {
			return "BAD";
		}
		return "neutral"; // ì¤‘ë¦½ì ì¸ ê²½ìš°
	}

	// í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ ë©”ì†Œë“œ
	private void resetTest() {
		// ëª¨ë“  ì ìˆ˜ ì´ˆê¸°í™”
		ieScores = new int[2];
		snScores = new int[2];
		tfScores = new int[2];
		jpScores = new int[2];

		// ê¸°íƒ€ ë³€ìˆ˜ë“¤ ì´ˆê¸°í™”
		currentStep = 0;
		isAnimalStep = true;
		animalSelectionCount = 0;
		plantSelectionCount = 0;
		userName = null;
		userPhone = null;
		userMBTI = null;
	}

	// ì‚¬ìš©ì ì…ë ¥ì„ ë°›ëŠ” ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ í‘œì‹œí•˜ëŠ” ë©”ì†Œë“œ
	public static void showUserInputDialog() {
		JFrame inputFrame = new JFrame("Find Your MBTI!");
		inputFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		inputFrame.setSize(400, 300);
		inputFrame.setLayout(new GridBagLayout());
		inputFrame.setLocationRelativeTo(null);

		GridBagConstraints gbc = new GridBagConstraints();
		gbc.fill = GridBagConstraints.HORIZONTAL;
		gbc.insets = new Insets(10, 10, 10, 10);

		JLabel nameLabel = new JLabel("ì´ë¦„:");
		gbc.gridx = 0;
		gbc.gridy = 0;
		inputFrame.add(nameLabel, gbc);

		JTextField nameField = new JTextField(15);
		gbc.gridx = 1;
		gbc.gridy = 0;
		inputFrame.add(nameField, gbc);

		JLabel phoneLabel = new JLabel("í°ë²ˆí˜¸:");
		gbc.gridx = 0;
		gbc.gridy = 1;
		inputFrame.add(phoneLabel, gbc);

		JTextField phoneField = new JTextField(15);
		gbc.gridx = 1;
		gbc.gridy = 1;
		inputFrame.add(phoneField, gbc);

		JButton startButton = new JButton("ì‹œì‘");
		gbc.gridx = 0;
		gbc.gridy = 2;
		gbc.gridwidth = 2;
		inputFrame.add(startButton, gbc);

		JButton viewButton = new JButton("ì¡°íšŒ");
		gbc.gridy = 3;
		inputFrame.add(viewButton, gbc);

		JButton matchButton = new JButton("ì§ì§€ ë§Œë“¤ê¸°");
		gbc.gridx = 0;
		gbc.gridy = 4;
		gbc.gridwidth = 2;
		inputFrame.add(matchButton, gbc);

		matchButton.addActionListener(e -> showMatchingResults());

		startButton.addActionListener(e -> {
			String name = nameField.getText();
			String phone = phoneField.getText();
			if (!name.isEmpty() && !phone.isEmpty()) {
				inputFrame.dispose();
				new MBTITestGUI(name, phone);
			} else {
				JOptionPane.showMessageDialog(inputFrame, "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
			}
		});

		viewButton.addActionListener(e -> showSavedRecords());

		inputFrame.setVisible(true);
	}

	// ì €ì¥ëœ ê¸°ë¡ì„ ë³´ì—¬ì£¼ëŠ” ë©”ì†Œë“œ
	private static void showSavedRecords() {
		JFrame recordsFrame = new JFrame("ì €ì¥ëœ ëª©ë¡");
		recordsFrame.setSize(400, 300);
		recordsFrame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
		recordsFrame.setLocationRelativeTo(null);

		JTextArea recordsArea = new JTextArea();
		recordsArea.setEditable(false);
		JScrollPane scrollPane = new JScrollPane(recordsArea);
		recordsFrame.add(scrollPane, BorderLayout.CENTER);

		// DBì—ì„œ ë°ì´í„° ì¡°íšŒ
		MBTITestDAO dao = new MBTITestDAO();
		List<MBTITestDTO> results = dao.getAllResults();

		for (MBTITestDTO record : results) {
			recordsArea.append(String.format("ID: %d, ì´ë¦„: %s, í°ë²ˆí˜¸: %s, MBTI: %s\n", record.getId(), record.getName(),
					record.getPhone(), record.getMbti()));
		}

		recordsFrame.setVisible(true);
	}

	// ë§¤ì¹­ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ëŠ” ë©”ì†Œë“œ
	private static void showMatchingResults() {
		JFrame matchFrame = new JFrame("ì§ì§€ ë§Œë“¤ê¸° ê²°ê³¼");
		matchFrame.setSize(500, 400);
		matchFrame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
		matchFrame.setLocationRelativeTo(null);

		JTextArea matchArea = new JTextArea();
		matchArea.setEditable(false);
		matchArea.setFont(new Font("ë§‘ì€ ê³ ë”•", Font.PLAIN, 14));
		JScrollPane scrollPane = new JScrollPane(matchArea);
		matchFrame.add(scrollPane);

		// DBì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
		MBTITestDAO dao = new MBTITestDAO();
		List<MBTITestDTO> allResults = dao.getAllResults();

		// ë§¤ì¹­ ê²°ê³¼ ê³„ì‚° ë° í‘œì‹œ
		List<MatchPair> matches = findBestMatches(allResults);

		matchArea.append("ğŸ”¥ MBTI ê¶í•© ë§¤ì¹­ ê²°ê³¼ ğŸ”¥\n\n");
		for (MatchPair pair : matches) {
			if (pair.person2 != null) {
				matchArea.append(String.format("â–¶ ë§¤ì¹­ ì§ì§€\n- %s (%s)\n- %s (%s)\nê¶í•© ì ìˆ˜: %dì \n\n", pair.person1.getName(),
						pair.person1.getMbti(), pair.person2.getName(), pair.person2.getMbti(),
						pair.compatibilityScore));
			} else {
				matchArea.append(
						String.format("â–¶ ë§¤ì¹­ ëŒ€ê¸°\n- %s (%s)\n\n", pair.person1.getName(), pair.person1.getMbti()));
			}
		}

		matchFrame.setVisible(true);
	}

	// ë§¤ì¹­ ìŒì„ ì €ì¥í•  í´ë˜ìŠ¤
	private static class MatchPair {
		MBTITestDTO person1;
		MBTITestDTO person2;
		int compatibilityScore;

		MatchPair(MBTITestDTO person1, MBTITestDTO person2, int score) {
			this.person1 = person1;
			this.person2 = person2;
			this.compatibilityScore = score;
		}
	}

	// ê°€ì¥ ê¶í•©ì´ ì¢‹ì€ ìŒì„ ì°¾ëŠ” ë©”ì†Œë“œ
	private static List<MatchPair> findBestMatches(List<MBTITestDTO> people) {
		List<MatchPair> matches = new ArrayList<>();
		List<MBTITestDTO> unmatched = new ArrayList<>(people);

		while (unmatched.size() >= 2) {
			int bestScore = -1;
			MBTITestDTO bestPerson1 = null;
			MBTITestDTO bestPerson2 = null;

			// ê°€ì¥ ê¶í•©ì´ ì¢‹ì€ ìŒ ì°¾ê¸°
			for (int i = 0; i < unmatched.size(); i++) {
				for (int j = i + 1; j < unmatched.size(); j++) {
					int score = calculateCompatibilityScore(unmatched.get(i).getMbti(), unmatched.get(j).getMbti());
					if (score > bestScore) {
						bestScore = score;
						bestPerson1 = unmatched.get(i);
						bestPerson2 = unmatched.get(j);
					}
				}
			}

			if (bestPerson1 != null && bestPerson2 != null) {
				matches.add(new MatchPair(bestPerson1, bestPerson2, bestScore));
				unmatched.remove(bestPerson1);
				unmatched.remove(bestPerson2);
			}
		}

		// ë‚¨ì€ í•œ ëª…ì´ ìˆë‹¤ë©´ ë§¤ì¹­ ëŒ€ê¸°ìë¡œ ì¶”ê°€
		if (!unmatched.isEmpty()) {
			matches.add(new MatchPair(unmatched.get(0), null, 0));
		}

		return matches;
	}

	// ìŠ¤í”Œë˜ì‹œ í™”ë©´ì„ ë³´ì—¬ì£¼ëŠ” ë©”ì†Œë“œ
	public static void showSplashScreen() {
		JWindow splash = new JWindow();
		ImageIcon splashIcon = new ImageIcon(MBTITestGUI.class.getResource("/images/splash.jpg"));

		if (splashIcon != null) {
			// ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ (ì›ë³¸ì˜ 2/3 í¬ê¸°)
			Image scaledImage = splashIcon.getImage().getScaledInstance(splashIcon.getIconWidth() / 3 * 2,
					splashIcon.getIconHeight() / 3 * 2, Image.SCALE_SMOOTH);

			JLabel splashLabel = new JLabel(new ImageIcon(scaledImage));
			splash.getContentPane().add(splashLabel);
			splash.pack();
			splash.setLocationRelativeTo(null); // í™”ë©´ ì¤‘ì•™ì— í‘œì‹œ
			splash.setVisible(true);

			// 3ì´ˆ í›„ì— ìŠ¤í”Œë˜ì‹œ í™”ë©´ì„ ë‹«ê³  ë©”ì¸ í™”ë©´ í‘œì‹œ
			Timer timer = new Timer(3000, e -> {
				splash.dispose();
				showUserInputDialog();
			});
			timer.setRepeats(false);
			timer.start();
		} else {
			// ìŠ¤í”Œë˜ì‹œ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš° ë°”ë¡œ ë©”ì¸ í™”ë©´ í‘œì‹œ
			showUserInputDialog();
		}
	}
}
